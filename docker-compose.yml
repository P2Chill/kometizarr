services:
  backend:
    build: ./web/backend
    container_name: kometizarr-backend
    ports:
      - "8000:8000"
    volumes:
      - ./:/app/kometizarr  # Mount entire project
      - ./web/backend:/app/backend  # Mount backend source for hot-reload (no rebuild needed)
      - ./data/backups:/backups  # Poster backups (PERSISTENT - survives reboots)
      - ./data/temp:/temp  # Temp processing
    environment:
      - PLEX_URL=${PLEX_URL:-http://192.168.1.20:32400}
      - PLEX_TOKEN=${PLEX_TOKEN}
      - TMDB_API_KEY=${TMDB_API_KEY}
      - OMDB_API_KEY=${OMDB_API_KEY}
      - MDBLIST_API_KEY=${MDBLIST_API_KEY}
    restart: unless-stopped
    networks:
      - kometizarr

  frontend:
    build: ./web/frontend
    container_name: kometizarr-frontend
    ports:
      - "3001:80"
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - kometizarr

networks:
  kometizarr:
    driver: bridge
